import Head from 'next/head'
import type { GetServerSideProps, NextPage } from 'next/types'
import { useEffect } from 'react'
import { getProductsByQuery } from '../firebase/firebaseRequests'
import packageInfo from '../../package.json'
import { Product, useProductContext } from '../contexts/ProductContext'
import Heading from '../components/Heading'
import Shelf from '../components/Shelf'

interface IndexProps {
  nikeShelfData: Product[]
  asicsShelfData: Product[]
  orangeShelfData: Product[]
}

const Index: NextPage<IndexProps> = ({ nikeShelfData, asicsShelfData, orangeShelfData }) => {
  const { getProducts, currentProducts } = useProductContext()

  useEffect(() => {
    getProducts() // aqui os dados s√£o gerados no cliente n√£o por SSR
  }, [])

  return (
    <>
      <Head>
        <title>Fireshoes üî•</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <section className="w-11/12 m-auto">
        <Heading text="Home" center/>
        <p className="text-center">Vers√£o {packageInfo.version}</p>

        <Shelf data={currentProducts} title="Todos os Produtos" />
        <Shelf data={orangeShelfData} title="Rosas üíú" />
        <Shelf data={nikeShelfData} title="S√≥ os Nikess" />
        <Shelf data={asicsShelfData} title="Asics? Temos" />
      </section>
    </>
  )
}

export const getServerSideProps: GetServerSideProps = async () => {
  return {
    props: {
      nikeShelfData: await getProductsByQuery('where', 'brand', 'Nike'),
      asicsShelfData: await getProductsByQuery('where', 'brand', 'Asics'),
      orangeShelfData: await getProductsByQuery('array', 'colors', 'Rosa')
    }
  }
}

export default Index
